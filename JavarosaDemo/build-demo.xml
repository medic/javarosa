<?xml version="1.0" encoding="UTF-8"?>
<project default="antenna-build" name="JavaRosaMidlet">
	<path id="classpath.org.javarosa.midlet">
		<path location="${path.build.classes}" />
		<path location="${path.build.classes}/_no_export" />
		<path
			location="${project.root.org.javarosa.communication}/lib/tinylinegzip.jar" />
		<path
			location="${project.root.org.javarosa.core}/lib/cldc_crypto.zip" />
	</path>
	<target name="antenna-initialize">
		<echo
			message="Initializing EclipseME Antenna build environment..." />
		<taskdef resource="antenna.properties">
			<classpath location="${path.antenna.jar}" />
		</taskdef>
		<mkdir dir="${path.build.classes}/_no_export" />
	</target>
	<target depends="antenna-initialize" name="antenna-build">
		<echo message="Building source files..." />
		<wtkbuild destdir="${path.build.classes}"
			encoding="${src.encoding}" source="1.3" sourcepath=""
			srcdir="${project.root.org.javarosa.demo}/src">
			<src
				path="${project.root.org.javarosa.communication.bluetooth.client}/src" />
			<src path="${project.root.org.javarosa.core}/src" />
			<src path="${project.root.org.javarosa.core}/test" />
			<src path="${project.root.org.javarosa.core.model}/src" />
			<src path="${project.root.org.javarosa.core.mvc}/src" />
			<src path="${project.root.org.javarosa.core.util}/src" />
			<src path="${project.root.org.javarosa.model}/src" />
			<src path="${project.root.org.javarosa.model}/test" />
			<src path="${project.root.org.javarosa.util}/src" />
			<src path="${project.root.org.javarosa.util.db}/src" />
			<src path="${project.root.org.javarosa.util.db}/test" />
			<src path="${project.root.org.javarosa.communication}/src" />
			<exclude name="**/.svn/" />
			<exclude name="**/CVS/" />
			<classpath refid="classpath.org.javarosa.midlet" />
		</wtkbuild>
	</target>
	<target depends="antenna-build" name="antenna-jar">
		<echo message="Generating unobfuscated jar file..." />
		<antcall target="antenna-clean" />
		<delete includeEmptyDirs="true" quiet="true">
			<fileset dir="${path.build.output}" includes="*,*/**" />
		</delete>
		<antcall target="antenna-internal-package" />
	</target>
	<target depends="antenna-build" name="antenna-deployable">
		<echo message="Generating obfuscated jar file..." />
		<antcall target="antenna-clean" />
		<delete includeEmptyDirs="true" quiet="true">
			<fileset dir="${path.build.output}" includes="*,*/**" />
		</delete>
		<antcall target="antenna-internal-package">
			<param name="flag.should.obfuscate" value="true" />
		</antcall>
	</target>
	<target depends="antenna-build" name="antenna-internal-package">
		<copy file="${midlet.name}.jad" todir="${path.build.output}" />
		<wtkpackage autoversion="${flag.autoversion}"
			jadfile="${path.build.output}/${midlet.name}.jad"
			jarfile="${path.build.output}/${midlet.name}.jar" obfuscate="false"
			preverify="${flag.preverify}">
			<fileset dir="${path.build.classes}">
				<exclude name="_no_export/" />
			</fileset>
			<classpath refid="classpath.org.javarosa.midlet" />
			<fileset dir="${project.root.org.javarosa.midlet}/src">
				<exclude name="**/*.java" />
				<exclude name="build/" />
				<exclude name="**/.svn/" />
				<exclude name="**/CVS/" />
			</fileset>
			<zipfileset
				src="${project.root.org.javarosa.communication}/lib/tinylinegzip.jar" />
			<zipfileset
				src="${project.root.org.javarosa.core}/lib/cldc_classes.zip" />
			<zipfileset
				src="${project.root.org.javarosa.core}/lib/cldc_crypto.zip" />
		</wtkpackage>
		<antcall target="antenna-obfuscate" />
	</target>
	<target if="flag.should.obfuscate" name="antenna-obfuscate">
		<wtkobfuscate jadfile="${path.build.output}/${midlet.name}.jad"
			jarfile="${path.build.output}/${midlet.name}.jar">
			<argument
				value="'-keep public class * extends javax.microedition.midlet.MIDlet'" />
			<argument
				value="-dontusemixedcaseclassnames -dontnote -defaultpackage ''" />
		</wtkobfuscate>
		<wtkpreverify if="flag.preverify"
			jadfile="${path.build.output}/${midlet.name}.jad"
			jarfile="${path.build.output}/${midlet.name}.jar" />
	</target>
	<target depends="antenna-deployable" name="antenna-run">
		<echo message="Running emulator..." />
		<wtkrun device="${run.device.name}"
			jadfile="${path.build.output}/${midlet.name}.jad"
			trace="${run.trace.options}" wait="true" />
	</target>
	<target depends="antenna-deployable" name="antenna-makeprc">
		<echo message="Generating Palm PRC file..." />
		<wtkmakeprc jadfile="${path.build.output}/${midlet.name}.jad"
			prcfile="${path.build.output}/${midlet.name}.prc" />
	</target>
	<target name="antenna-clean">
		<delete includeEmptyDirs="true" quiet="true">
			<fileset dir="${path.build.classes}" includes="*,*/**" />
		</delete>
	</target>
</project>